# 流式回答和思考时间测试场景

## 测试场景1: 完整流式回答
1. 用户输入问题："推荐一个人工智能的导师"
2. 预期：显示思考时间约6-8秒，开始倒计时
3. 预期：收到API响应后，停止思考倒计时，开始流式显示
4. 预期：显示推荐的教授卡片（研究方向已AI简化）

## 测试场景2: 中断流式回答 ⭐ 重点测试
1. 用户输入问题
2. 预期：显示思考时间倒计时
3. **用户点击暂停按钮**（发送按钮变成暂停图标时点击）
4. 预期：
   - ✅ 停止思考倒计时
   - ✅ 停止流式生成
   - ✅ **消息右边显示"重来"和"继续"按钮**
   - ✅ 按钮样式正确（24rpx大小）

## 测试场景3: 重来功能 ⭐ 重点测试
1. 从场景2的状态，**点击"重来"按钮**
2. 预期：
   - ✅ 移除当前AI回答
   - ✅ 重新开始思考倒计时
   - ✅ 重新发送API请求，开始新的流式生成
   - ✅ 显示新的研究方向简化结果

## 测试场景4: 继续功能 ⭐ 重点测试
1. 从场景2的状态，**点击"继续"按钮**
2. 预期：
   - ✅ 显示较短的思考时间（原时间的一半，最大5秒）
   - ✅ 隐藏操作按钮，标记为流式生成
   - ✅ 从当前内容继续流式生成
   - ✅ 最终完成完整回答

## 测试场景5: 复杂问题与研究方向简化
1. 用户输入复杂问题："我想找一个在深度学习和计算机视觉方面有丰富研究经验的博士生导师，要求在顶级会议发表过论文，最好有工业界合作项目经验？"
2. 预期：思考时间约12-15秒（接近上限）
3. 验证关键词识别：深度学习、计算机视觉、博士、导师、论文、项目、问号
4. **重点验证**：教授卡片中的研究方向是否被AI简化为不超过100字的关键词

## 关键验证要点

### UI显示验证
- [ ] 流式回答中断后，按钮正确显示在消息右边
- [ ] 重来按钮图标：/images/start-over.svg
- [ ] 继续按钮图标：/images/continue.svg
- [ ] 按钮大小：24rpx × 24rpx
- [ ] 按钮布局：垂直排列，间距10rpx

### 功能逻辑验证
- [ ] `stopGeneration()` 正确调用 `addActionButtonsToLastMessage()`
- [ ] `addActionButtonsToLastMessage()` 正确设置 `showActions: true`
- [ ] `regenerateAnswer()` 能找到对应用户消息并重新发送
- [ ] `continueAnswer()` 能从当前内容继续生成
- [ ] 思考时间在所有操作中正确显示和停止

### 研究方向简化验证
- [ ] 教授卡片显示简化后的研究方向
- [ ] 简化结果不超过100字
- [ ] 保持学术专业性
- [ ] AI失败时备用方案正常工作

### 错误处理验证
- [ ] API调用失败时按钮仍然显示
- [ ] 网络异常时功能降级处理
- [ ] 用户快速点击时状态正确

## 调试要点

如果按钮不显示，检查：
1. `item.showActions` 是否为 `true`
2. `item.type` 是否为 `'assistant'`
3. 控制台日志："已为消息添加操作按钮"

如果按钮功能不工作，检查：
1. `data-id` 是否正确传递消息ID
2. 事件绑定是否正确：`bindtap="regenerateAnswer"`
3. 函数内部逻辑是否找到正确的消息

## 注意事项
- 小程序需要在微信开发者工具中运行
- 需要云函数正常工作
- 确保网络连接正常
- 测试时注意观察控制台日志输出
