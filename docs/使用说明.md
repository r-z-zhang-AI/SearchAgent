# Excel数据导入云函数使用说明

## 功能说明

`importProfessorsData` 云函数用于将Excel格式的教授数据导入到云数据库中。

## 支持的Excel列名

函数支持以下列名的数据导入：

### 基础信息字段
- `url` - 教授个人主页链接
- `教师姓名` - 教师姓名（必填字段之一）
- `中文名` - 中文姓名（必填字段之一，与教师姓名至少要有一个）
- `毕业院校` - 毕业院校信息
- `院系职称` - 院系中的职称
- `院系` - 所属院系
- `学历` - 学历信息
- `职称` - 职称级别
- `邮箱` - 联系邮箱
- `地址` - 办公地址
- `研究方向` - 研究领域和方向
- `单位` - 工作单位
- `个人简介` - 个人简介信息

### 扩展信息字段
- `info1` 到 `info17` - 17个扩展信息字段，可存储额外信息

## 数据处理规则

### 1. 空值处理
- 如果某个字段为空（null、undefined、空字符串、只包含空白字符），则该字段不会被添加到数据库记录中
- 这样可以保持数据库的精简，避免存储无意义的空值

### 2. 数据清理
- 自动去除字段值首尾的空白字符
- 将"null"、"undefined"字符串视为空值处理
- 对研究方向字段，会将中英文分号统一替换为逗号分隔

### 3. 数据验证
- 至少需要有"教师姓名"或"中文名"其中一个字段不为空
- 每条记录至少需要有2个以上的有效字段
- 邮箱字段会进行基本的格式验证

### 4. 特殊处理
- 邮箱格式检查：如果邮箱格式不正确会在日志中警告，但不会阻止导入
- 研究方向标准化：统一使用逗号+空格分隔多个研究方向

## 使用步骤

### 1. 准备Excel文件
- 确保Excel文件的第一行为列名（表头）
- 列名需要与上述支持的字段名完全一致
- 文件格式支持 .xlsx 和 .xls

### 2. 上传到云存储
1. 在微信开发者工具的云开发控制台中
2. 进入"存储"页面
3. 上传Excel文件到路径：`data/professors.xlsx`
   - **注意**：路径必须是 `data/professors.xlsx`，否则云函数找不到文件

### 3. 执行导入
1. 在云开发控制台进入"云函数"页面
2. 找到 `importProfessorsData` 函数
3. 点击"测试"或"云端测试"
4. 不需要传入任何参数，直接点击"调用"

### 4. 查看结果
- 在函数执行日志中查看详细的导入过程
- 函数会返回导入统计信息：
  ```json
  {
    "success": true,
    "message": "Excel数据导入完成！总计: 100 条, 成功: 95 条, 失败: 2 条, 跳过: 3 条",
    "data": {
      "total": 100,
      "successCount": 95,
      "failCount": 2,
      "skippedCount": 3
    }
  }
  ```

## 注意事项

### 1. 数据覆盖
- **重要**：每次执行导入都会在现有数据基础上添加新数据
- 如果需要清空现有数据重新导入，请在云数据库控制台手动清空 `professors` 集合

### 2. 文件大小限制
- 云存储单个文件不能超过 100MB
- 建议单次导入的数据量不超过 10000 条

### 3. 字段名匹配
- Excel表头的列名必须与支持的字段名完全一致（区分大小写）
- 如果列名不匹配，该列数据会被忽略

### 4. 性能考虑
- 大量数据导入可能需要较长时间
- 云函数执行有超时限制，超大数据集可能需要分批导入

## 错误排查

### 常见问题
1. **找不到文件**：检查Excel文件是否上传到了正确路径 `data/professors.xlsx`
2. **解析失败**：检查Excel文件格式是否正确，确保不是损坏的文件
3. **导入失败**：查看函数日志，通常是数据格式问题

### 日志查看
在云函数的"日志"标签页可以看到详细的执行过程，包括：
- 每个步骤的执行状态
- 数据验证警告
- 具体的错误信息

## 示例Excel格式

| 教师姓名 | 中文名 | 院系 | 职称 | 邮箱 | 研究方向 | info1 |
|---------|-------|------|------|------|----------|-------|
| Zhang Wei | 张伟 | 计算机学院 | 教授 | zhang@zju.edu.cn | 人工智能,机器学习 | 博士生导师 |
| Li Ming | 李明 | 数学系 | 副教授 | li@zju.edu.cn | 应用数学 |  |

**注意**：空单元格会被自动忽略，不会在数据库中创建对应的字段。
