# é‡æ–°ç”Ÿæˆå’Œç»§ç»­ç”ŸæˆåŠŸèƒ½ä¼˜åŒ– + æµå¼ç”Ÿæˆå®ç°

## ğŸ”§ å·²å®Œæˆçš„æ”¹è¿›

### 1. å›¾æ ‡å¤§å°ä¼˜åŒ–
**CSSæ ·å¼è°ƒæ•´**ï¼š
```css
.regenerate-icon, .continue-icon {
  width: 24rpx;  /* ä»32rpxå‡å°åˆ°24rpx */
  height: 24rpx; /* ä»32rpxå‡å°åˆ°24rpx */
}
```

### 2. ğŸŒŸ æµå¼ç”ŸæˆåŠŸèƒ½ï¼ˆæ–°å¢ï¼‰
**æ ¸å¿ƒç‰¹æ€§**ï¼š
- âœ… é€å­—é€å¥æ˜¾ç¤ºå›ç­”å†…å®¹
- âœ… ç±»ä¼¼ChatGPTçš„å®æ—¶æ‰“å­—æ•ˆæœ
- âœ… å¯ä¸­æ–­çš„æµå¼ç”Ÿæˆ
- âœ… è§†è§‰æŒ‡ç¤ºå™¨ï¼ˆé—ªçƒå…‰æ ‡ï¼‰

**å®ç°åŸç†**ï¼š
```javascript
// æµå¼è¯·æ±‚å¤„ç†
async streamingRequest(message, messageId) {
  const fullResponse = "å®Œæ•´çš„å›ç­”å†…å®¹...";
  let currentIndex = 0;
  
  const streamInterval = setInterval(() => {
    if (currentIndex < fullResponse.length) {
      // æ¯æ¬¡æ·»åŠ 1-3ä¸ªå­—ç¬¦ï¼Œæ¨¡æ‹ŸçœŸå®æ‰“å­—
      const chunkSize = Math.min(Math.floor(Math.random() * 3) + 1, 
                                fullResponse.length - currentIndex);
      currentIndex += chunkSize;
      
      // å®æ—¶æ›´æ–°ç•Œé¢
      this.updateStreamingMessage(messageId, fullResponse.slice(0, currentIndex));
    } else {
      // å®Œæˆç”Ÿæˆ
      this.finishStreaming(messageId);
    }
  }, 50 + Math.random() * 100); // 50-150mséšæœºé—´éš”
}
```

**è§†è§‰æ•ˆæœ**ï¼š
```css
/* æ‰“å­—å…‰æ ‡åŠ¨ç”» */
.typing-cursor {
  color: #007aff;
  animation: blink 1s infinite;
}

@keyframes blink {
  0%, 50% { opacity: 1; }
  51%, 100% { opacity: 0; }
}
```

**WXMLæ¨¡æ¿**ï¼š
```xml
<view class="message-content">
  {{item.content}}
  <text wx:if="{{item.isStreaming}}" class="typing-cursor">|</text>
</view>
```

### 3. è¯·æ±‚ä¸­æ–­æœºåˆ¶ä¼˜åŒ–
**æµå¼ç”Ÿæˆä¸­æ–­**ï¼š
```javascript
stopGeneration() {
  this.userAborted = true;
  
  // ä¸­æ–­æµå¼ç”Ÿæˆå®šæ—¶å™¨
  if (this.streamInterval) {
    clearInterval(this.streamInterval);
  }
  
  // æ·»åŠ æ“ä½œæŒ‰é’®
  this.addActionButtonsToLastMessage();
}
```

### 4. ç»§ç»­ç”Ÿæˆæµå¼æ”¯æŒ
**æµå¼ç»§ç»­ç”Ÿæˆ**ï¼š
```javascript
streamingContinue(originalQuestion, currentContent, messageId) {
  // åœ¨åŸæœ‰å†…å®¹åŸºç¡€ä¸Šç»§ç»­æµå¼è¿½åŠ 
  const continueResponse = "\n\nç»§ç»­ç”Ÿæˆçš„å†…å®¹...";
  
  // æµå¼è¿½åŠ åˆ°ç°æœ‰å†…å®¹
  this.updateStreamingMessage(messageId, currentContent + newPart);
}
```

## ğŸ“± ç”¨æˆ·ä½“éªŒæå‡

### æµå¼ç”Ÿæˆä½“éªŒ
1. **å³æ—¶åé¦ˆ**ï¼šç”¨æˆ·å‘é€æ¶ˆæ¯åç«‹å³çœ‹åˆ°å›ç­”å¼€å§‹ç”Ÿæˆ
2. **å®æ—¶è¿›åº¦**ï¼šå¯ä»¥å®æ—¶çœ‹åˆ°å›ç­”çš„ç”Ÿæˆè¿›åº¦
3. **è‡ªç„¶ä½“éªŒ**ï¼šæ¨¡æ‹ŸçœŸäººæ‰“å­—çš„è‡ªç„¶èŠ‚å¥
4. **å¯æ§åˆ¶**ï¼šä»»ä½•æ—¶å€™éƒ½å¯ä»¥ä¸­æ–­ç”Ÿæˆ

### äº¤äº’æµç¨‹
```
ç”¨æˆ·å‘é€æ¶ˆæ¯
    â†“
åˆ›å»ºç©ºçš„åŠ©æ‰‹æ¶ˆæ¯
    â†“
å¼€å§‹æµå¼ç”Ÿæˆ (æ˜¾ç¤ºå…‰æ ‡)
    â†“
é€å­—æ˜¾ç¤ºå†…å®¹
    â†“
ç”¨æˆ·å¯éšæ—¶ä¸­æ–­ â†’ æ˜¾ç¤ºé‡æ–°ç”Ÿæˆ/ç»§ç»­ç”ŸæˆæŒ‰é’®
    â†“
ç”Ÿæˆå®Œæˆ (éšè—å…‰æ ‡)
    â†“
æ˜¾ç¤ºæ•™æˆæ¨èå¡ç‰‡
```

### è§†è§‰æŒ‡ç¤º
- **ç”Ÿæˆä¸­**: è“è‰²é—ªçƒå…‰æ ‡ `|`
- **å¯ä¸­æ–­**: æš‚åœæŒ‰é’®ä¿æŒå¯ç”¨
- **å®Œæˆ**: å…‰æ ‡æ¶ˆå¤±ï¼Œæ˜¾ç¤ºå®Œæ•´å†…å®¹

## ğŸš€ æŠ€æœ¯å®ç°è¦ç‚¹

### æµå¼æ•°æ®ç®¡ç†
```javascript
// æ¶ˆæ¯çŠ¶æ€æ ‡è®°
{
  id: 'msg-123',
  content: 'å®æ—¶æ›´æ–°çš„å†…å®¹',
  isStreaming: true,  // æµå¼ç”ŸæˆçŠ¶æ€
  teacherCards: []
}
```

### æ€§èƒ½ä¼˜åŒ–
- **éšæœºé—´éš”**: 50-150msæ¨¡æ‹ŸçœŸå®æ‰“å­—
- **å—å¤§å°**: æ¯æ¬¡1-3ä¸ªå­—ç¬¦ï¼Œé¿å…è¿‡å¿«æˆ–è¿‡æ…¢
- **å†…å­˜ç®¡ç†**: åŠæ—¶æ¸…ç†å®šæ—¶å™¨ï¼Œé¿å…å†…å­˜æ³„æ¼

### é”™è¯¯å¤„ç†
```javascript
// ä¸­æ–­å¤„ç†
if (this.userAborted) {
  clearInterval(streamInterval);
  reject(new Error('ç”¨æˆ·ä¸­æ–­'));
  return;
}
```

## ğŸ”„ å‘åå…¼å®¹

- ä¿æŒåŸæœ‰APIæ¥å£ä¸å˜
- æ”¯æŒä¼ ç»Ÿä¸€æ¬¡æ€§å“åº”æ¨¡å¼
- æµå¼ç”Ÿæˆå¯éšæ—¶åˆ‡æ¢åˆ°ä¸­æ–­æ¨¡å¼

## ğŸ¯ æœªæ¥æ‰©å±•

### çœŸå®æµå¼APIé›†æˆ
```javascript
// WebSocketå®ç°
const ws = new WebSocket('wss://api.example.com/stream');
ws.onmessage = (event) => {
  const chunk = JSON.parse(event.data);
  this.updateStreamingMessage(messageId, chunk.content);
};

// Server-Sent Eventså®ç°
const eventSource = new EventSource('/api/stream');
eventSource.onmessage = (event) => {
  const chunk = JSON.parse(event.data);
  this.updateStreamingMessage(messageId, chunk.content);
};
```

ç°åœ¨ç”¨æˆ·å¯ä»¥äº«å—ç±»ä¼¼ChatGPTçš„æµå¼å›ç­”ä½“éªŒï¼ğŸ‰
